(function(window,doc){function prefixStyle(style){return""===vendor?style:(style=style.charAt(0).toUpperCase()+style.substr(1),vendor+style)}var m=Math,dummyStyle=doc.createElement("div").style,vendor=function(){for(var t,vendors="t,webkitT,MozT,msT,OT".split(","),i=0,l=vendors.length;l>i;i++)if(t=vendors[i]+"ransform",t in dummyStyle)return vendors[i].substr(0,vendors[i].length-1);return!1}(),cssVendor=vendor?"-"+vendor.toLowerCase()+"-":"",transform=prefixStyle("transform"),transitionProperty=prefixStyle("transitionProperty"),transitionDuration=prefixStyle("transitionDuration"),transformOrigin=prefixStyle("transformOrigin"),transitionTimingFunction=prefixStyle("transitionTimingFunction"),transitionDelay=prefixStyle("transitionDelay"),isAndroid=/android/gi.test(navigator.appVersion),isIDevice=/iphone|ipad/gi.test(navigator.appVersion),isTouchPad=/hp-tablet/gi.test(navigator.appVersion),has3d=prefixStyle("perspective")in dummyStyle,hasTouch="ontouchstart"in window&&!isTouchPad,hasTransform=vendor!==!1,hasTransitionEnd=prefixStyle("transition")in dummyStyle,RESIZE_EV="onorientationchange"in window?"orientationchange":"resize",START_EV=hasTouch?"touchstart":"mousedown",MOVE_EV=hasTouch?"touchmove":"mousemove",END_EV=hasTouch?"touchend":"mouseup",CANCEL_EV=hasTouch?"touchcancel":"mouseup",TRNEND_EV=function(){if(vendor===!1)return!1;var transitionEnd={"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",O:"otransitionend",ms:"MSTransitionEnd"};return transitionEnd[vendor]}(),nextFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){return setTimeout(callback,1)}}(),cancelFrame=function(){return window.cancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}(),translateZ=has3d?" translateZ(0)":"",iScroll=function(el,options){var i,that=this;that.wrapper="object"==typeof el?el:doc.getElementById(el),that.wrapper.style.overflow="hidden",that.scroller=that.wrapper.children[0],that.options={hScroll:!0,vScroll:!0,x:0,y:0,bounce:!0,bounceLock:!1,momentum:!0,lockDirection:!0,useTransform:!0,useTransition:!1,topOffset:0,checkDOMChanges:!1,handleClick:!0,hScrollbar:!0,vScrollbar:!0,fixedScrollbar:isAndroid,hideScrollbar:isIDevice,fadeScrollbar:isIDevice&&has3d,scrollbarClass:"",zoom:!1,zoomMin:1,zoomMax:4,doubleTapZoom:2,wheelAction:"scroll",snap:!1,snapThreshold:1,onRefresh:null,onBeforeScrollStart:function(e){e.preventDefault()},onScrollStart:null,onBeforeScrollMove:null,onScrollMove:null,onBeforeScrollEnd:null,onScrollEnd:null,onTouchEnd:null,onDestroy:null,onZoomStart:null,onZoom:null,onZoomEnd:null};for(i in options)that.options[i]=options[i];that.x=that.options.x,that.y=that.options.y,that.options.useTransform=hasTransform&&that.options.useTransform,that.options.hScrollbar=that.options.hScroll&&that.options.hScrollbar,that.options.vScrollbar=that.options.vScroll&&that.options.vScrollbar,that.options.zoom=that.options.useTransform&&that.options.zoom,that.options.useTransition=hasTransitionEnd&&that.options.useTransition,that.options.zoom&&isAndroid&&(translateZ=""),that.scroller.style[transitionProperty]=that.options.useTransform?cssVendor+"transform":"top left",that.scroller.style[transitionDuration]="0",that.scroller.style[transformOrigin]="0 0",that.options.useTransition&&(that.scroller.style[transitionTimingFunction]="cubic-bezier(0.33,0.66,0.66,1)"),that.options.useTransform?that.scroller.style[transform]="translate("+that.x+"px,"+that.y+"px)"+translateZ:that.scroller.style.cssText+=";position:absolute;top:"+that.y+"px;left:"+that.x+"px",that.options.useTransition&&(that.options.fixedScrollbar=!0),that.refresh(),that._bind(RESIZE_EV,window),that._bind(START_EV),hasTouch||"none"!=that.options.wheelAction&&(that._bind("DOMMouseScroll"),that._bind("mousewheel")),that.options.checkDOMChanges&&(that.checkDOMTime=setInterval(function(){that._checkDOMChanges()},500))};iScroll.prototype={enabled:!0,x:0,y:0,steps:[],scale:1,currPageX:0,currPageY:0,pagesX:[],pagesY:[],aniTime:null,wheelZoomCount:0,handleEvent:function(e){var that=this;switch(e.type){case START_EV:if(!hasTouch&&0!==e.button)return;that._start(e);break;case MOVE_EV:that._move(e);break;case END_EV:case CANCEL_EV:that._end(e);break;case RESIZE_EV:that._resize();break;case"DOMMouseScroll":case"mousewheel":that._wheel(e);break;case TRNEND_EV:that._transitionEnd(e)}},_checkDOMChanges:function(){this.moved||this.zoomed||this.animating||this.scrollerW==this.scroller.offsetWidth*this.scale&&this.scrollerH==this.scroller.offsetHeight*this.scale||this.refresh()},_scrollbar:function(dir){var bar,that=this;return that[dir+"Scrollbar"]?(that[dir+"ScrollbarWrapper"]||(bar=doc.createElement("div"),that.options.scrollbarClass?bar.className=that.options.scrollbarClass+dir.toUpperCase():bar.style.cssText="position:absolute;z-index:100;"+("h"==dir?"height:7px;bottom:1px;left:2px;right:"+(that.vScrollbar?"7":"2")+"px":"width:7px;bottom:"+(that.hScrollbar?"7":"2")+"px;top:2px;right:1px"),bar.style.cssText+=";pointer-events:none;"+cssVendor+"transition-property:opacity;"+cssVendor+"transition-duration:"+(that.options.fadeScrollbar?"350ms":"0")+";overflow:hidden;opacity:"+(that.options.hideScrollbar?"0":"1"),that.wrapper.appendChild(bar),that[dir+"ScrollbarWrapper"]=bar,bar=doc.createElement("div"),that.options.scrollbarClass||(bar.style.cssText="position:absolute;z-index:100;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);"+cssVendor+"background-clip:padding-box;"+cssVendor+"box-sizing:border-box;"+("h"==dir?"height:100%":"width:100%")+";"+cssVendor+"border-radius:3px;border-radius:3px"),bar.style.cssText+=";pointer-events:none;"+cssVendor+"transition-property:"+cssVendor+"transform;"+cssVendor+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);"+cssVendor+"transition-duration:0;"+cssVendor+"transform: translate(0,0)"+translateZ,that.options.useTransition&&(bar.style.cssText+=";"+cssVendor+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1)"),that[dir+"ScrollbarWrapper"].appendChild(bar),that[dir+"ScrollbarIndicator"]=bar),"h"==dir?(that.hScrollbarSize=that.hScrollbarWrapper.clientWidth,that.hScrollbarIndicatorSize=m.max(m.round(that.hScrollbarSize*that.hScrollbarSize/that.scrollerW),8),that.hScrollbarIndicator.style.width=that.hScrollbarIndicatorSize+"px",that.hScrollbarMaxScroll=that.hScrollbarSize-that.hScrollbarIndicatorSize,that.hScrollbarProp=that.hScrollbarMaxScroll/that.maxScrollX):(that.vScrollbarSize=that.vScrollbarWrapper.clientHeight,that.vScrollbarIndicatorSize=m.max(m.round(that.vScrollbarSize*that.vScrollbarSize/that.scrollerH),8),that.vScrollbarIndicator.style.height=that.vScrollbarIndicatorSize+"px",that.vScrollbarMaxScroll=that.vScrollbarSize-that.vScrollbarIndicatorSize,that.vScrollbarProp=that.vScrollbarMaxScroll/that.maxScrollY),that._scrollbarPos(dir,!0),void 0):(that[dir+"ScrollbarWrapper"]&&(hasTransform&&(that[dir+"ScrollbarIndicator"].style[transform]=""),that[dir+"ScrollbarWrapper"].parentNode.removeChild(that[dir+"ScrollbarWrapper"]),that[dir+"ScrollbarWrapper"]=null,that[dir+"ScrollbarIndicator"]=null),void 0)},_resize:function(){var that=this;setTimeout(function(){that.refresh()},isAndroid?200:0)},_pos:function(x,y){this.zoomed||(x=this.hScroll?x:0,y=this.vScroll?y:0,this.options.useTransform?this.scroller.style[transform]="translate("+x+"px,"+y+"px) scale("+this.scale+")"+translateZ:(x=m.round(x),y=m.round(y),this.scroller.style.left=x+"px",this.scroller.style.top=y+"px"),this.x=x,this.y=y,this._scrollbarPos("h"),this._scrollbarPos("v"))},_scrollbarPos:function(dir,hidden){var size,that=this,pos="h"==dir?that.x:that.y;that[dir+"Scrollbar"]&&(pos=that[dir+"ScrollbarProp"]*pos,0>pos?(that.options.fixedScrollbar||(size=that[dir+"ScrollbarIndicatorSize"]+m.round(3*pos),8>size&&(size=8),that[dir+"ScrollbarIndicator"].style["h"==dir?"width":"height"]=size+"px"),pos=0):pos>that[dir+"ScrollbarMaxScroll"]&&(that.options.fixedScrollbar?pos=that[dir+"ScrollbarMaxScroll"]:(size=that[dir+"ScrollbarIndicatorSize"]-m.round(3*(pos-that[dir+"ScrollbarMaxScroll"])),8>size&&(size=8),that[dir+"ScrollbarIndicator"].style["h"==dir?"width":"height"]=size+"px",pos=that[dir+"ScrollbarMaxScroll"]+(that[dir+"ScrollbarIndicatorSize"]-size))),that[dir+"ScrollbarWrapper"].style[transitionDelay]="0",that[dir+"ScrollbarWrapper"].style.opacity=hidden&&that.options.hideScrollbar?"0":"1",that[dir+"ScrollbarIndicator"].style[transform]="translate("+("h"==dir?pos+"px,0)":"0,"+pos+"px)")+translateZ)},_start:function(e){var matrix,x,y,c1,c2,that=this,point=hasTouch?e.touches[0]:e;that.enabled&&(that.options.onBeforeScrollStart&&that.options.onBeforeScrollStart.call(that,e),(that.options.useTransition||that.options.zoom)&&that._transitionTime(0),that.moved=!1,that.animating=!1,that.zoomed=!1,that.distX=0,that.distY=0,that.absDistX=0,that.absDistY=0,that.dirX=0,that.dirY=0,that.options.zoom&&hasTouch&&e.touches.length>1&&(c1=m.abs(e.touches[0].pageX-e.touches[1].pageX),c2=m.abs(e.touches[0].pageY-e.touches[1].pageY),that.touchesDistStart=m.sqrt(c1*c1+c2*c2),that.originX=m.abs(e.touches[0].pageX+e.touches[1].pageX-2*that.wrapperOffsetLeft)/2-that.x,that.originY=m.abs(e.touches[0].pageY+e.touches[1].pageY-2*that.wrapperOffsetTop)/2-that.y,that.options.onZoomStart&&that.options.onZoomStart.call(that,e)),that.options.momentum&&(that.options.useTransform?(matrix=getComputedStyle(that.scroller,null)[transform].replace(/[^0-9\-.,]/g,"").split(","),x=+(matrix[12]||matrix[4]),y=+(matrix[13]||matrix[5])):(x=+getComputedStyle(that.scroller,null).left.replace(/[^0-9-]/g,""),y=+getComputedStyle(that.scroller,null).top.replace(/[^0-9-]/g,"")),(x!=that.x||y!=that.y)&&(that.options.useTransition?that._unbind(TRNEND_EV):cancelFrame(that.aniTime),that.steps=[],that._pos(x,y),that.options.onScrollEnd&&that.options.onScrollEnd.call(that))),that.absStartX=that.x,that.absStartY=that.y,that.startX=that.x,that.startY=that.y,that.pointX=point.pageX,that.pointY=point.pageY,that.startTime=e.timeStamp||Date.now(),that.options.onScrollStart&&that.options.onScrollStart.call(that,e),that._bind(MOVE_EV,window),that._bind(END_EV,window),that._bind(CANCEL_EV,window))},_move:function(e){var c1,c2,scale,that=this,point=hasTouch?e.touches[0]:e,deltaX=point.pageX-that.pointX,deltaY=point.pageY-that.pointY,newX=that.x+deltaX,newY=that.y+deltaY,timestamp=e.timeStamp||Date.now();return that.options.onBeforeScrollMove&&that.options.onBeforeScrollMove.call(that,e),that.options.zoom&&hasTouch&&e.touches.length>1?(c1=m.abs(e.touches[0].pageX-e.touches[1].pageX),c2=m.abs(e.touches[0].pageY-e.touches[1].pageY),that.touchesDist=m.sqrt(c1*c1+c2*c2),that.zoomed=!0,scale=1/that.touchesDistStart*that.touchesDist*this.scale,that.options.zoomMin>scale?scale=.5*that.options.zoomMin*Math.pow(2,scale/that.options.zoomMin):scale>that.options.zoomMax&&(scale=2*that.options.zoomMax*Math.pow(.5,that.options.zoomMax/scale)),that.lastScale=scale/this.scale,newX=this.originX-this.originX*that.lastScale+this.x,newY=this.originY-this.originY*that.lastScale+this.y,this.scroller.style[transform]="translate("+newX+"px,"+newY+"px) scale("+scale+")"+translateZ,that.options.onZoom&&that.options.onZoom.call(that,e),void 0):(that.pointX=point.pageX,that.pointY=point.pageY,(newX>0||that.maxScrollX>newX)&&(newX=that.options.bounce?that.x+deltaX/2:newX>=0||that.maxScrollX>=0?0:that.maxScrollX),(newY>that.minScrollY||that.maxScrollY>newY)&&(newY=that.options.bounce?that.y+deltaY/2:newY>=that.minScrollY||that.maxScrollY>=0?that.minScrollY:that.maxScrollY),that.distX+=deltaX,that.distY+=deltaY,that.absDistX=m.abs(that.distX),that.absDistY=m.abs(that.distY),6>that.absDistX&&6>that.absDistY||(that.options.lockDirection&&(that.absDistX>that.absDistY+5?(newY=that.y,deltaY=0):that.absDistY>that.absDistX+5&&(newX=that.x,deltaX=0)),that.moved=!0,that._pos(newX,newY),that.dirX=deltaX>0?-1:0>deltaX?1:0,that.dirY=deltaY>0?-1:0>deltaY?1:0,timestamp-that.startTime>300&&(that.startTime=timestamp,that.startX=that.x,that.startY=that.y),that.options.onScrollMove&&that.options.onScrollMove.call(that,e)),void 0)},_end:function(e){if(!hasTouch||0===e.touches.length){var target,ev,distX,distY,newDuration,snap,scale,that=this,point=hasTouch?e.changedTouches[0]:e,momentumX={dist:0,time:0},momentumY={dist:0,time:0},duration=(e.timeStamp||Date.now())-that.startTime,newPosX=that.x,newPosY=that.y;if(that._unbind(MOVE_EV,window),that._unbind(END_EV,window),that._unbind(CANCEL_EV,window),that.options.onBeforeScrollEnd&&that.options.onBeforeScrollEnd.call(that,e),that.zoomed)return scale=that.scale*that.lastScale,scale=Math.max(that.options.zoomMin,scale),scale=Math.min(that.options.zoomMax,scale),that.lastScale=scale/that.scale,that.scale=scale,that.x=that.originX-that.originX*that.lastScale+that.x,that.y=that.originY-that.originY*that.lastScale+that.y,that.scroller.style[transitionDuration]="200ms",that.scroller.style[transform]="translate("+that.x+"px,"+that.y+"px) scale("+that.scale+")"+translateZ,that.zoomed=!1,that.refresh(),that.options.onZoomEnd&&that.options.onZoomEnd.call(that,e),void 0;if(!that.moved)return hasTouch&&(that.doubleTapTimer&&that.options.zoom?(clearTimeout(that.doubleTapTimer),that.doubleTapTimer=null,that.options.onZoomStart&&that.options.onZoomStart.call(that,e),that.zoom(that.pointX,that.pointY,1==that.scale?that.options.doubleTapZoom:1),that.options.onZoomEnd&&setTimeout(function(){that.options.onZoomEnd.call(that,e)},200)):this.options.handleClick&&(that.doubleTapTimer=setTimeout(function(){for(that.doubleTapTimer=null,target=point.target;1!=target.nodeType;)target=target.parentNode;"SELECT"!=target.tagName&&"INPUT"!=target.tagName&&"TEXTAREA"!=target.tagName&&(ev=doc.createEvent("MouseEvents"),ev.initMouseEvent("click",!0,!0,e.view,1,point.screenX,point.screenY,point.clientX,point.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,0,null),ev._fake=!0,target.dispatchEvent(ev))},that.options.zoom?250:0))),that._resetPos(400),that.options.onTouchEnd&&that.options.onTouchEnd.call(that,e),void 0;if(300>duration&&that.options.momentum&&(momentumX=newPosX?that._momentum(newPosX-that.startX,duration,-that.x,that.scrollerW-that.wrapperW+that.x,that.options.bounce?that.wrapperW:0):momentumX,momentumY=newPosY?that._momentum(newPosY-that.startY,duration,-that.y,0>that.maxScrollY?that.scrollerH-that.wrapperH+that.y-that.minScrollY:0,that.options.bounce?that.wrapperH:0):momentumY,newPosX=that.x+momentumX.dist,newPosY=that.y+momentumY.dist,(that.x>0&&newPosX>0||that.x<that.maxScrollX&&that.maxScrollX>newPosX)&&(momentumX={dist:0,time:0}),(that.y>that.minScrollY&&newPosY>that.minScrollY||that.y<that.maxScrollY&&that.maxScrollY>newPosY)&&(momentumY={dist:0,time:0})),momentumX.dist||momentumY.dist)return newDuration=m.max(m.max(momentumX.time,momentumY.time),10),that.options.snap&&(distX=newPosX-that.absStartX,distY=newPosY-that.absStartY,m.abs(distX)<that.options.snapThreshold&&m.abs(distY)<that.options.snapThreshold?that.scrollTo(that.absStartX,that.absStartY,200):(snap=that._snap(newPosX,newPosY),newPosX=snap.x,newPosY=snap.y,newDuration=m.max(snap.time,newDuration))),that.scrollTo(m.round(newPosX),m.round(newPosY),newDuration),that.options.onTouchEnd&&that.options.onTouchEnd.call(that,e),void 0;if(that.options.snap)return distX=newPosX-that.absStartX,distY=newPosY-that.absStartY,m.abs(distX)<that.options.snapThreshold&&m.abs(distY)<that.options.snapThreshold?that.scrollTo(that.absStartX,that.absStartY,200):(snap=that._snap(that.x,that.y),(snap.x!=that.x||snap.y!=that.y)&&that.scrollTo(snap.x,snap.y,snap.time)),that.options.onTouchEnd&&that.options.onTouchEnd.call(that,e),void 0;that._resetPos(200),that.options.onTouchEnd&&that.options.onTouchEnd.call(that,e)}},_resetPos:function(time){var that=this,resetX=that.x>=0?0:that.x<that.maxScrollX?that.maxScrollX:that.x,resetY=that.y>=that.minScrollY||that.maxScrollY>0?that.minScrollY:that.y<that.maxScrollY?that.maxScrollY:that.y;return resetX==that.x&&resetY==that.y?(that.moved&&(that.moved=!1,that.options.onScrollEnd&&that.options.onScrollEnd.call(that)),that.hScrollbar&&that.options.hideScrollbar&&("webkit"==vendor&&(that.hScrollbarWrapper.style[transitionDelay]="300ms"),that.hScrollbarWrapper.style.opacity="0"),that.vScrollbar&&that.options.hideScrollbar&&("webkit"==vendor&&(that.vScrollbarWrapper.style[transitionDelay]="300ms"),that.vScrollbarWrapper.style.opacity="0"),void 0):(that.scrollTo(resetX,resetY,time||0),void 0)},_wheel:function(e){var wheelDeltaX,wheelDeltaY,deltaX,deltaY,deltaScale,that=this;if("wheelDeltaX"in e)wheelDeltaX=e.wheelDeltaX/12,wheelDeltaY=e.wheelDeltaY/12;else if("wheelDelta"in e)wheelDeltaX=wheelDeltaY=e.wheelDelta/12;else{if(!("detail"in e))return;wheelDeltaX=wheelDeltaY=3*-e.detail}return"zoom"==that.options.wheelAction?(deltaScale=that.scale*Math.pow(2,1/3*(wheelDeltaY?wheelDeltaY/Math.abs(wheelDeltaY):0)),that.options.zoomMin>deltaScale&&(deltaScale=that.options.zoomMin),deltaScale>that.options.zoomMax&&(deltaScale=that.options.zoomMax),deltaScale!=that.scale&&(!that.wheelZoomCount&&that.options.onZoomStart&&that.options.onZoomStart.call(that,e),that.wheelZoomCount++,that.zoom(e.pageX,e.pageY,deltaScale,400),setTimeout(function(){that.wheelZoomCount--,!that.wheelZoomCount&&that.options.onZoomEnd&&that.options.onZoomEnd.call(that,e)},400)),void 0):(deltaX=that.x+wheelDeltaX,deltaY=that.y+wheelDeltaY,deltaX>0?deltaX=0:that.maxScrollX>deltaX&&(deltaX=that.maxScrollX),deltaY>that.minScrollY?deltaY=that.minScrollY:that.maxScrollY>deltaY&&(deltaY=that.maxScrollY),0>that.maxScrollY&&that.scrollTo(deltaX,deltaY,0),void 0)},_transitionEnd:function(e){var that=this;e.target==that.scroller&&(that._unbind(TRNEND_EV),that._startAni())},_startAni:function(){var step,easeOut,animate,that=this,startX=that.x,startY=that.y,startTime=Date.now();if(!that.animating){if(!that.steps.length)return that._resetPos(400),void 0;if(step=that.steps.shift(),step.x==startX&&step.y==startY&&(step.time=0),that.animating=!0,that.moved=!0,that.options.useTransition)return that._transitionTime(step.time),that._pos(step.x,step.y),that.animating=!1,step.time?that._bind(TRNEND_EV):that._resetPos(0),void 0;animate=function(){var newX,newY,now=Date.now();return now>=startTime+step.time?(that._pos(step.x,step.y),that.animating=!1,that.options.onAnimationEnd&&that.options.onAnimationEnd.call(that),that._startAni(),void 0):(now=(now-startTime)/step.time-1,easeOut=m.sqrt(1-now*now),newX=(step.x-startX)*easeOut+startX,newY=(step.y-startY)*easeOut+startY,that._pos(newX,newY),that.animating&&(that.aniTime=nextFrame(animate)),void 0)},animate()}},_transitionTime:function(time){time+="ms",this.scroller.style[transitionDuration]=time,this.hScrollbar&&(this.hScrollbarIndicator.style[transitionDuration]=time),this.vScrollbar&&(this.vScrollbarIndicator.style[transitionDuration]=time)},_momentum:function(dist,time,maxDistUpper,maxDistLower,size){var deceleration=6e-4,speed=m.abs(dist)/time,newDist=speed*speed/(2*deceleration),newTime=0,outsideDist=0;return dist>0&&newDist>maxDistUpper?(outsideDist=size/(6/(newDist/speed*deceleration)),maxDistUpper+=outsideDist,speed=speed*maxDistUpper/newDist,newDist=maxDistUpper):0>dist&&newDist>maxDistLower&&(outsideDist=size/(6/(newDist/speed*deceleration)),maxDistLower+=outsideDist,speed=speed*maxDistLower/newDist,newDist=maxDistLower),newDist*=0>dist?-1:1,newTime=speed/deceleration,{dist:newDist,time:m.round(newTime)}},_offset:function(el){for(var left=-el.offsetLeft,top=-el.offsetTop;el=el.offsetParent;)left-=el.offsetLeft,top-=el.offsetTop;return el!=this.wrapper&&(left*=this.scale,top*=this.scale),{left:left,top:top}},_snap:function(x,y){var i,l,page,time,sizeX,sizeY,that=this;for(page=that.pagesX.length-1,i=0,l=that.pagesX.length;l>i;i++)if(x>=that.pagesX[i]){page=i;break}for(page==that.currPageX&&page>0&&0>that.dirX&&page--,x=that.pagesX[page],sizeX=m.abs(x-that.pagesX[that.currPageX]),sizeX=sizeX?500*(m.abs(that.x-x)/sizeX):0,that.currPageX=page,page=that.pagesY.length-1,i=0;page>i;i++)if(y>=that.pagesY[i]){page=i;break}return page==that.currPageY&&page>0&&0>that.dirY&&page--,y=that.pagesY[page],sizeY=m.abs(y-that.pagesY[that.currPageY]),sizeY=sizeY?500*(m.abs(that.y-y)/sizeY):0,that.currPageY=page,time=m.round(m.max(sizeX,sizeY))||200,{x:x,y:y,time:time}},_bind:function(type,el,bubble){(el||this.scroller).addEventListener(type,this,!!bubble)},_unbind:function(type,el,bubble){(el||this.scroller).removeEventListener(type,this,!!bubble)},destroy:function(){var that=this;that.scroller.style[transform]="",that.hScrollbar=!1,that.vScrollbar=!1,that._scrollbar("h"),that._scrollbar("v"),that._unbind(RESIZE_EV,window),that._unbind(START_EV),that._unbind(MOVE_EV,window),that._unbind(END_EV,window),that._unbind(CANCEL_EV,window),that.options.hasTouch||(that._unbind("DOMMouseScroll"),that._unbind("mousewheel")),that.options.useTransition&&that._unbind(TRNEND_EV),that.options.checkDOMChanges&&clearInterval(that.checkDOMTime),that.options.onDestroy&&that.options.onDestroy.call(that)},refresh:function(){var offset,i,l,els,that=this,pos=0,page=0;if(that.scale<that.options.zoomMin&&(that.scale=that.options.zoomMin),that.wrapperW=that.wrapper.clientWidth||1,that.wrapperH=that.wrapper.clientHeight||1,that.minScrollY=-that.options.topOffset||0,that.scrollerW=m.round(that.scroller.offsetWidth*that.scale),that.scrollerH=m.round((that.scroller.offsetHeight+that.minScrollY)*that.scale),that.maxScrollX=that.wrapperW-that.scrollerW,that.maxScrollY=that.wrapperH-that.scrollerH+that.minScrollY,that.dirX=0,that.dirY=0,that.options.onRefresh&&that.options.onRefresh.call(that),that.hScroll=that.options.hScroll&&0>that.maxScrollX,that.vScroll=that.options.vScroll&&(!that.options.bounceLock&&!that.hScroll||that.scrollerH>that.wrapperH),that.hScrollbar=that.hScroll&&that.options.hScrollbar,that.vScrollbar=that.vScroll&&that.options.vScrollbar&&that.scrollerH>that.wrapperH,offset=that._offset(that.wrapper),that.wrapperOffsetLeft=-offset.left,that.wrapperOffsetTop=-offset.top,"string"==typeof that.options.snap)for(that.pagesX=[],that.pagesY=[],els=that.scroller.querySelectorAll(that.options.snap),i=0,l=els.length;l>i;i++)pos=that._offset(els[i]),pos.left+=that.wrapperOffsetLeft,pos.top+=that.wrapperOffsetTop,that.pagesX[i]=pos.left<that.maxScrollX?that.maxScrollX:pos.left*that.scale,that.pagesY[i]=pos.top<that.maxScrollY?that.maxScrollY:pos.top*that.scale;else if(that.options.snap){for(that.pagesX=[];pos>=that.maxScrollX;)that.pagesX[page]=pos,pos-=that.wrapperW,page++;for(that.maxScrollX%that.wrapperW&&(that.pagesX[that.pagesX.length]=that.maxScrollX-that.pagesX[that.pagesX.length-1]+that.pagesX[that.pagesX.length-1]),pos=0,page=0,that.pagesY=[];pos>=that.maxScrollY;)that.pagesY[page]=pos,pos-=that.wrapperH,page++;that.maxScrollY%that.wrapperH&&(that.pagesY[that.pagesY.length]=that.maxScrollY-that.pagesY[that.pagesY.length-1]+that.pagesY[that.pagesY.length-1])}that._scrollbar("h"),that._scrollbar("v"),that.zoomed||(that.scroller.style[transitionDuration]="0",that._resetPos(400))},scrollTo:function(x,y,time,relative){var i,l,that=this,step=x;for(that.stop(),step.length||(step=[{x:x,y:y,time:time,relative:relative}]),i=0,l=step.length;l>i;i++)step[i].relative&&(step[i].x=that.x-step[i].x,step[i].y=that.y-step[i].y),that.steps.push({x:step[i].x,y:step[i].y,time:step[i].time||0});that._startAni()},scrollToElement:function(el,time){var pos,that=this;el=el.nodeType?el:that.scroller.querySelector(el),el&&(pos=that._offset(el),pos.left+=that.wrapperOffsetLeft,pos.top+=that.wrapperOffsetTop,pos.left=pos.left>0?0:pos.left<that.maxScrollX?that.maxScrollX:pos.left,pos.top=pos.top>that.minScrollY?that.minScrollY:pos.top<that.maxScrollY?that.maxScrollY:pos.top,time=void 0===time?m.max(2*m.abs(pos.left),2*m.abs(pos.top)):time,that.scrollTo(pos.left,pos.top,time))},scrollToPage:function(pageX,pageY,time){var x,y,that=this;time=void 0===time?400:time,that.options.onScrollStart&&that.options.onScrollStart.call(that),that.options.snap?(pageX="next"==pageX?that.currPageX+1:"prev"==pageX?that.currPageX-1:pageX,pageY="next"==pageY?that.currPageY+1:"prev"==pageY?that.currPageY-1:pageY,pageX=0>pageX?0:pageX>that.pagesX.length-1?that.pagesX.length-1:pageX,pageY=0>pageY?0:pageY>that.pagesY.length-1?that.pagesY.length-1:pageY,that.currPageX=pageX,that.currPageY=pageY,x=that.pagesX[pageX],y=that.pagesY[pageY]):(x=-that.wrapperW*pageX,y=-that.wrapperH*pageY,that.maxScrollX>x&&(x=that.maxScrollX),that.maxScrollY>y&&(y=that.maxScrollY)),that.scrollTo(x,y,time)},disable:function(){this.stop(),this._resetPos(0),this.enabled=!1,this._unbind(MOVE_EV,window),this._unbind(END_EV,window),this._unbind(CANCEL_EV,window)},enable:function(){this.enabled=!0},stop:function(){this.options.useTransition?this._unbind(TRNEND_EV):cancelFrame(this.aniTime),this.steps=[],this.moved=!1,this.animating=!1},zoom:function(x,y,scale,time){var that=this,relScale=scale/that.scale;that.options.useTransform&&(that.zoomed=!0,time=void 0===time?200:time,x=x-that.wrapperOffsetLeft-that.x,y=y-that.wrapperOffsetTop-that.y,that.x=x-x*relScale+that.x,that.y=y-y*relScale+that.y,that.scale=scale,that.refresh(),that.x=that.x>0?0:that.x<that.maxScrollX?that.maxScrollX:that.x,that.y=that.y>that.minScrollY?that.minScrollY:that.y<that.maxScrollY?that.maxScrollY:that.y,that.scroller.style[transitionDuration]=time+"ms",that.scroller.style[transform]="translate("+that.x+"px,"+that.y+"px) scale("+scale+")"+translateZ,that.zoomed=!1)},isReady:function(){return!this.moved&&!this.zoomed&&!this.animating}},dummyStyle=null,"undefined"!=typeof exports?exports.iScroll=iScroll:window.iScroll=iScroll})(window,document);